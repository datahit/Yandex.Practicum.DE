Задача: построить витрину для RFM-анализа


1. Витрина должна располагаться в той же базе в схеме analysis
2. Название витрины dm_rfm_segments
3. Витрина должна состоять из таких полей:
- user_id
- recency (число от 1 до 5)
- frequency (число от 1 до 5)
- monetary_value (число от 1 до 5)
4. глубина данных: в витрине нужны данные с начала 2021 года.
5. Обновления витрины не нужны
6. Успешно выполненный заказ имеет статус Closed

RFM-сегментация:
Каждому клиенту присвоить три значения — Recency, Frequency и Monetary
- Фактор Recency. 1 получат те, кто либо вообще не делал заказов, либо делал их очень давно, а 5 — те, кто заказывал относительно недавно.
- Фактор Frequency. 1 получат клиенты с наименьшим количеством заказов, а 5 — с наибольшим.
- Фактор Monetary. 1 получат клиенты с наименьшей суммой, а 5 — с наибольшей.

Проверка:
Количество клиентов в каждом сегменте одинаково. Например, если в базе всего 100 клиентов, то 20 клиентов должны получить значение 1, ещё 20 — значение 2 и т. д.


Поля и таблицы для расчета витрины:
recency - давность заказа. Берем из таблицы orders. Используем поля order_id, order_ts. Для каждого клиента из таблицы users определяем последний заказ, используем поле user id (для обезличенности данных). 
Frequency - количество заказов. Берем из таблицы orders, используем поле order_id чтобы вести подсчет количества заказов. Чтобы отобразить всех пользователей используем также таблицу users.
Monetary - сумма всей заказов по каждому клиенту. Расчитываем из таблицы orders. Cтатус заказов должен быть закрыт. Суммируем по полю payment. Чтобы отобразить всех пользователей используем также таблицу users.
